---
title: 租房评测
nav:
  title: 应用合集
  path: /applications
  order: 5
group:
  title: 默认
  path: /default-app
  order: 1
---

# 租房评测

租房评测，通过理性的方式判断房子的情况

## 应用程序

```jsx
/**
 * inline: true
 */
import React from 'react';
import { RentalEvaluation } from '@bestlyg/applications';
export default RentalEvaluation;
```

## [核心代码](https://gitee.com/bestlyg/bestlyg/tree/master/packages/applications/src/defaultApp/RentalEvaluation/useRentalEvaluation.ts)

```ts
import React, { useState, useCallback, useEffect, useMemo } from 'react';
import DataSet from '@antv/data-set';
import { getLocalStorage, setLocalStorage } from '@bestlyg/shared';

enum Evaluation {
  距离地铁距离 = '距离地铁距离',
  电动车停放与充电的方便程度 = '电动车停放与充电的方便程度',
  电梯有无 = '电梯有无',
  楼层高度 = '楼层高度',
  '小区周边设施（如快递站，垃圾桶）齐全程度' = '小区周边设施（如快递站，垃圾桶）齐全程度',
  小区环境好不好 = '小区环境好不好',
  房间大不大 = '房间大不大',
  每个房间内无线信号与4G5G信号的强度 = '每个房间内无线信号与4G5G信号的强度',
  水电费收费标准 = '水电费收费标准',
  '其他服务费收取情况（维修费，宽带费）' = '其他服务费收取情况（维修费，宽带费）',
  房租 = '房租',
  距离公司地点远近 = '距离公司地点远近',
}
const EVALUATION_COUNT = Object.keys(Evaluation).length;
const StroageTag_RentalEvaluation = 'RentalEvaluation';
interface EvaluationItem {
  item: Evaluation;
  value: number;
  weight: number;
}
interface Rental {
  title: string;
  evaluation: EvaluationItem[];
}
const createInitEvaluation = (): EvaluationItem[] =>
  Object.keys(Evaluation).map(item => ({
    item: item as Evaluation,
    value: 5,
    weight: 1,
  }));
export const useRentalEvaluation = () => {
  const [rentalList, setRentalList] = useState<Rental[]>([
    { title: '默认', evaluation: createInitEvaluation() },
  ]);
  const [rentalIndex, setRentalIndex] = useState<number>(0);
  const [rentalTitle, setRentalTitle] = useState('');
  // chart
  const chartScale = useMemo(() => {
    let max = 10;
    rentalList[rentalIndex].evaluation.forEach(({ weight }) => {
      let num = Math.ceil(10 * weight);
      while (num++ % 5 !== 0);
      max = Math.max(max, num);
    });
    return {
      value: {
        min: 0,
        max,
      },
    };
  }, [rentalList, rentalIndex]);
  const chartData = useMemo(() => {
    const dv = new DataSet.DataView().source(rentalList[rentalIndex].evaluation);
    dv.transform({
      type: 'map',
      callback(row: EvaluationItem) {
        row.value = row.value * row.weight; // 为每条记录新添加一个 z 字段
        return row;
      },
    });
    return dv.rows;
  }, [rentalList, rentalIndex]);
  // add
  const onAddRental = useCallback(() => {
    const list = [...rentalList, { title: rentalTitle, evaluation: createInitEvaluation() }];
    setRentalList(list);
    setRentalIndex(list.length - 1);
    setRentalTitle('');
    setLocalStorage(StroageTag_RentalEvaluation, JSON.stringify(list));
  }, [rentalList, setRentalList, rentalTitle, setRentalTitle]);
  // del
  const delOptions = useMemo(
    () => rentalList.map(({ title }, i) => ({ label: title, value: i })).filter((_, i) => i !== 0),
    [rentalList]
  );
  const [delList, setDelList] = useState<number[]>([]);

  const onDelRental = useCallback(() => {
    const set = new Set(delList);
    const list = rentalList.filter((_, i) => !set.has(i));
    setRentalList(list);
    setRentalIndex(0);
    setRentalTitle('');
    setLocalStorage(StroageTag_RentalEvaluation, JSON.stringify(list));
  }, [rentalList, setRentalList, rentalTitle, setRentalTitle, delList]);
  const score = useMemo(
    () =>
      rentalList[rentalIndex].evaluation.reduce(
        (total, { value, weight }) => total + value * weight,
        0
      ),
    [rentalList, rentalIndex]
  );
  const reset = useCallback(() => {
    const list = [...rentalList];
    list[rentalIndex].evaluation = createInitEvaluation();
    setRentalList(list);
    setLocalStorage(StroageTag_RentalEvaluation, JSON.stringify(list));
  }, [setRentalList, rentalList, rentalIndex]);
  const onEvaluationChange = useCallback(
    (value, field, index) => {
      const list = [...rentalList];
      list[rentalIndex].evaluation[index][field] = value;
      setRentalList(list);
      setLocalStorage(StroageTag_RentalEvaluation, JSON.stringify(list));
    },
    [setRentalList, rentalList, rentalIndex]
  );
  useEffect(() => {
    try {
      const meta = getLocalStorage(StroageTag_RentalEvaluation);
      if (!meta) return;
      const list = JSON.parse(meta) as Rental[];
      list[0].evaluation.length === EVALUATION_COUNT && setRentalList(list);
    } catch {}
  }, []);
  return {
    rentalIndex,
    setRentalIndex,
    rentalList,
    rentalTitle,
    setRentalTitle,
    onAddRental,
    delOptions,
    delList,
    setDelList,
    onDelRental,
    score,
    reset,
    onEvaluationChange,
    chartData,
    chartScale,
  };
};
```
