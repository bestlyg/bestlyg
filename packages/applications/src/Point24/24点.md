---
title: 24点
nav:
  title: 应用合集
  path: /applications
  order: 4
group:
  title: 数字游戏
  path: /number-game
  order: 2
---

# 24 点

随机给出四个 1-10 之间的数字，通过+、-、\*、/、（、）六个运算符进行运算求能算出 24 的算式。

## 应用程序

```jsx
/**
 * inline: true
 */
import React from 'react';
import { Point24 } from '@bestlyg/applications';
export default Point24;
```

## 核心代码

```ts
import { random } from 'lodash';
import { useCallback, useEffect, useState } from 'react';

/** 最小数 */
export const MIN = 1;
/** 最大数 */
export const MAX = 10;
/** 数的数量 */
export const NUM_COUNT = 4;
/** 求和值 */
export const SUM = 24;
/** 操作运算符 */
export const OP = ['+', '-', '*', '/'];
/** 操作运算符全排列 */
export const OP_List: string[][] = [];
OP.forEach(op1 => OP.forEach(op2 => OP.forEach(op3 => OP_List.push([op1, op2, op3]))));
/** 数数组的全排列 */
export const getList = <T extends Array<any>>(arr: T): T[] => {
  const l = arr.length;
  if (l === 1) return [arr];
  const res: T[] = [];
  for (let i = 0; i < l; i++) {
    const nextArr = [...arr.slice(0, i), ...arr.slice(i + 1)] as T;
    const nextList = getList(nextArr);
    res.push(...nextList.map(v => [arr[i], ...v] as T));
  }
  return res;
};
/** 列举所有可能的模板 */
export const getTemplates = (
  [num1, num2, num3, num4]: [number, number, number, number],
  [op1, op2, op3]: [string, string, string]
): string[] => [
  `${num1}${op1}(${num2}${op2}${num3})${op3}${num4}`,
  `(${num1}${op1}${num2})${op2}(${num3}${op3}${num4})`,
  `${num1}${op1}(${num2}${op2}${num3}${op3}${num4})`,
  `(${num1}${op1}${num2}${op2}${num3})${op3}${num4}`,
  `${num1}${op1}${num2}${op2}(${num3}${op3}${num4})`,
  `(${num1}${op1}${num2})${op2}${num3}${op3}${num4}`,
  `${num1}${op1}${num2}${op2}${num3}${op3}${num4}`,
];
/** 计算值，考虑存在除法后的小数 */
export const compute = (nums: number[]): Set<string> => {
  const ans = new Set<string>();
  const numList = getList(nums);
  for (const nums of numList) {
    for (const ops of OP_List) {
      for (const template of getTemplates(
        nums as [number, number, number, number],
        ops as [string, string, string]
      )) {
        const comp = eval(template) as number;
        if (comp > SUM - 6e-10 && comp < SUM + 6e-10) ans.add(template);
      }
    }
  }
  return ans;
};
export const usePoint24 = () => {
  /** 数数组 */
  const [nums, setNums] = useState<number[]>([]);
  /** 解法集合 */
  const [solutions, setSolutions] = useState<Set<string>>(new Set());
  /** 刷新 */
  const refresh = useCallback(() => {
    const arr = new Array(NUM_COUNT).fill(0).map(_ => random(MIN, MAX));
    setNums(arr);
    setSolutions(compute(arr));
  }, []);
  /** 更改数 */
  const onNumChange = useCallback(
    (value: number, index: number) => {
      const arr = [...nums];
      arr[index] = value;
      setNums(arr);
      setSolutions(compute(arr));
    },
    [nums]
  );
  useEffect(() => {
    refresh();
  }, []);
  return {
    nums,
    solutions,
    refresh,
    onNumChange,
    setNums,
    setSolutions,
  };
};
```
