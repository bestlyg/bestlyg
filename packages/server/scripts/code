class Solution:
    def countPalindromicSubsequence(self, s: str) -> int:
        cright = Counter(s)
        cleft = Counter()
        n = len(s)
        used = defaultdict(set)
        matched = set()
        for c in s:
            cright[c] -= 1
            if (cleft[c] == 0 or cright[c] == 0) and c in matched:
                matched.remove(c)
            used[c] |= matched
            cleft[c] += 1
            if cleft[c] > 0 and cright[c] > 0:
                matched.add(c)
        return sum(len(item) for item in used.values())