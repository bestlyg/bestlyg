class Solution:
    def maxUncrossedLines(self, nums1: List[int], nums2: List[int]) -> int:
        map2 = defaultdict(list)
        for i, num in enumerate(nums2): map2[num].append(i)
        @cache
        def run(idx: int, last: int) -> int:
            if idx == len(nums1): return 0
            res = run(idx + 1, last)
            for next_idx in map2[nums1[idx]]:
                if next_idx <= last: continue
                res = max(res, run(idx + 1, next_idx) + 1)
            return res
        return run(0, -1)